{% extends "stock/stock_base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Add Current Stock</h2>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" id="stockForm" action="{{ url_for('stock.add_current_stock') }}">
        <div class="form-group mb-3">
            <label for="pole_type">Pole Type:</label>
            <select class="form-control" id="pole_type" name="pole_type" required onchange="toggleFields()">
                <option value="">Select Pole Type</option>
                <option value="kdl_unsorted_stock">Unsorted Stock</option>
                <option value="kdl_untreated_stock">Untreated Stock</option>
                <option value="kdl_treated_poles">Treated Poles</option>
            </select>
        </div>

        <!-- Fields for Unsorted Stock -->
        <div id="unsortedFields" style="display: none;">
            <div class="form-group mb-3">
                <label for="pole_category">Pole Category:</label>
                <input type="text" class="form-control" id="pole_category" name="pole_category">
            </div>
            <div class="form-group mb-3">
                <label for="quantity">Quantity:</label>
                <input type="number" class="form-control" id="quantity" name="quantity" step="0.01">
            </div>
            <div class="form-group mb-3">
                <label for="supplier_id">Supplier ID:</label>
                <input type="text" class="form-control" id="supplier_id" name="supplier_id">
            </div>
            <div class="form-group mb-3">
                <label for="description">Description:</label>
                <textarea class="form-control" id="description" name="description"></textarea>
            </div>
        </div>

        <!-- Fields for Treated and Untreated Stock -->
        <div id="treatedFields" style="display: none;">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="rafters">Rafters:</label>
                    <input type="number" class="form-control" id="rafters" name="rafters" step="0.01" value="0">
                </div>
                <div class="col-md-4 mb-3">
                    <label for="timber">Timber:</label>
                    <input type="number" class="form-control" id="timber" name="timber" step="0.01" value="0">
                </div>
                <div class="col-md-4 mb-3">
                    <label for="fencing_poles">Fencing Poles:</label>
                    <input type="number" class="form-control" id="fencing_poles" name="fencing_poles" step="0.01" value="0">
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="telecom_poles">Telecom Poles:</label>
                    <input type="number" class="form-control" id="telecom_poles" name="telecom_poles" step="0.01" value="0">
                </div>
                {% for size in [7, 8, 9, 10, 11, 12, 14, 16] %}
                <div class="col-md-3 mb-3">
                    <label for="{{ size }}m">{{ size }}m:</label>
                    <input type="number" class="form-control" id="{{ size }}m" name="{{ size }}m" step="0.01" value="0">
                </div>
                {% endfor %}
                <div class="col-md-3 mb-3">
                    <label for="stubs">Stubs:</label>
                    <input type="number" class="form-control" id="stubs" name="stubs" step="0.01" value="0">
                </div>
            </div>
        </div>

        <!-- Cylinder Number (only for treated poles) -->
        <div id="cylinderField" style="display: none;">
            <div class="form-group mb-3">
                <label for="cylinder_no">Cylinder Number:</label>
                <input type="text" class="form-control" id="cylinder_no" name="cylinder_no">
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>

<script>
function toggleFields() {
    const poleType = document.getElementById('pole_type').value;
    const unsortedFields = document.getElementById('unsortedFields');
    const treatedFields = document.getElementById('treatedFields');
    const cylinderField = document.getElementById('cylinderField');

    // Hide all fields first
    unsortedFields.style.display = 'none';
    treatedFields.style.display = 'none';
    cylinderField.style.display = 'none';

    // Show relevant fields based on selection
    if (poleType === 'kdl_unsorted_stock') {
        unsortedFields.style.display = 'block';
    } else if (poleType === 'kdl_untreated_stock' || poleType === 'kdl_treated_poles') {
        treatedFields.style.display = 'block';
        if (poleType === 'kdl_treated_poles') {
            cylinderField.style.display = 'block';
        }
    }
}
</script>
{% endblock %}